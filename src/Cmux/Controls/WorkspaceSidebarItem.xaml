<UserControl x:Class="Cmux.Controls.WorkspaceSidebarItem"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Cmux.ViewModels">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Workspace name + notification badge -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="{Binding Name}"
                       Foreground="{StaticResource ForegroundBrush}"
                       FontSize="13" FontWeight="SemiBold"
                       TextTrimming="CharacterEllipsis" />

            <!-- Notification badge -->
            <Border Grid.Column="1" CornerRadius="8"
                    Background="{StaticResource NotificationBrush}"
                    Padding="5,1" Margin="4,0,0,0"
                    Visibility="{Binding HasNotification, Converter={StaticResource BoolToVisibility}}">
                <TextBlock Text="{Binding UnreadNotificationCount}"
                           Foreground="White" FontSize="10" />
            </Border>
        </Grid>

        <!-- AI Agent badge (gradient pill) -->
        <Border Grid.Row="1" CornerRadius="4" Padding="5,2" Margin="0,4,0,0"
                HorizontalAlignment="Left"
                Visibility="{Binding AgentLabel, Converter={StaticResource NullToCollapsed}}">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#FF6C5CE7" Offset="0" />
                    <GradientStop Color="#FFA855F7" Offset="1" />
                </LinearGradientBrush>
            </Border.Background>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding AgentIcon}" FontFamily="Segoe MDL2 Assets"
                           FontSize="9" Foreground="White" Margin="0,0,4,0"
                           VerticalAlignment="Center" />
                <TextBlock Text="{Binding AgentLabel}" FontSize="10"
                           Foreground="White" FontWeight="SemiBold" />
            </StackPanel>
        </Border>

        <!-- Git branch -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,3,0,0"
                    Visibility="{Binding GitBranch, Converter={StaticResource NullToCollapsed}}">
            <TextBlock Text="&#xE8AD;" FontFamily="Segoe MDL2 Assets" FontSize="10"
                       Foreground="{StaticResource ForegroundDimBrush}" Margin="0,0,4,0"
                       VerticalAlignment="Center" />
            <TextBlock Text="{Binding GitBranch}"
                       Foreground="{StaticResource AccentBrush}"
                       FontSize="11" TextTrimming="CharacterEllipsis" />
        </StackPanel>

        <!-- Working directory -->
        <TextBlock Grid.Row="3" Text="{Binding WorkingDirectory}"
                   Foreground="{StaticResource ForegroundDimBrush}"
                   FontSize="10" Margin="0,2,0,0"
                   TextTrimming="CharacterEllipsis"
                   Visibility="{Binding WorkingDirectory, Converter={StaticResource NullToCollapsed}}" />

        <!-- Latest notification text -->
        <TextBlock Grid.Row="4" Text="{Binding LatestNotificationText}"
                   Foreground="{StaticResource ForegroundDimBrush}"
                   FontSize="10" Margin="0,2,0,0"
                   TextTrimming="CharacterEllipsis" FontStyle="Italic"
                   Visibility="{Binding LatestNotificationText, Converter={StaticResource NullToCollapsed}}" />
    </Grid>
</UserControl>
