<Window x:Class="Cmux.Views.LogsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Command Logs" Height="660" Width="1120"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None" AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResize">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="34" CornerRadius="0" GlassFrameThickness="0"
                      ResizeBorderThickness="6" />
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <SolidColorBrush x:Key="{x:Static SystemColors.WindowBrushKey}" Color="#FF1A1A1A" />
        <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#FF1A1A1A" />
        <SolidColorBrush x:Key="{x:Static SystemColors.WindowTextBrushKey}" Color="#FFE2E2E9" />
        <SolidColorBrush x:Key="{x:Static SystemColors.ControlTextBrushKey}" Color="#FFE2E2E9" />
        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#FF252547" />
        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="#FFE2E2E9" />

        <Style x:Key="SettingsComboItem" TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#FF1A1A1A" />
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
            <Setter Property="Padding" Value="6,4" />
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#FF252547" />
                    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FF1E1E32" />
                    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SettingsCombo" TargetType="ComboBox">
            <Style.Resources>
                <SolidColorBrush x:Key="{x:Static SystemColors.WindowBrushKey}" Color="#FF1A1A1A" />
                <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#FF1A1A1A" />
                <SolidColorBrush x:Key="{x:Static SystemColors.WindowTextBrushKey}" Color="#FFE2E2E9" />
                <SolidColorBrush x:Key="{x:Static SystemColors.ControlTextBrushKey}" Color="#FFE2E2E9" />
                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#FF252547" />
                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="#FFE2E2E9" />
            </Style.Resources>
            <Setter Property="Background" Value="#FF1A1A1A" />
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
            <Setter Property="ItemContainerStyle" Value="{StaticResource SettingsComboItem}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <Border x:Name="Bd"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="4" />

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="28" />
                                </Grid.ColumnDefinitions>

                                <ContentPresenter x:Name="ContentSite"
                                                  Grid.Column="0"
                                                  Margin="8,0,4,0"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left"
                                                  Content="{TemplateBinding SelectionBoxItem}"
                                                  ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                  ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                  IsHitTestVisible="False" />

                                <TextBox x:Name="PART_EditableTextBox"
                                         Grid.Column="0"
                                         Margin="8,0,4,0"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Foreground="{TemplateBinding Foreground}"
                                         VerticalContentAlignment="Center"
                                         Visibility="Hidden" />

                                <Border Grid.Column="1" Background="#FF252547" CornerRadius="0,4,4,0" IsHitTestVisible="False">
                                    <TextBlock Text="&#xE70D;" FontFamily="Segoe MDL2 Assets"
                                               Foreground="{TemplateBinding Foreground}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               FontSize="10" />
                                </Border>

                                <ToggleButton Grid.ColumnSpan="2"
                                              Background="Transparent"
                                              BorderThickness="0"
                                              Focusable="False"
                                              ClickMode="Press"
                                              IsChecked="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                    <ToggleButton.Template>
                                        <ControlTemplate TargetType="ToggleButton">
                                            <Border Background="Transparent" />
                                        </ControlTemplate>
                                    </ToggleButton.Template>
                                </ToggleButton>
                            </Grid>

                            <Popup x:Name="PART_Popup"
                                   AllowsTransparency="True"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   Placement="Bottom"
                                   PlacementTarget="{Binding RelativeSource={RelativeSource TemplatedParent}}"
                                   StaysOpen="False"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Border x:Name="DropDownBorder"
                                        Margin="0,2,0,0"
                                        Background="#FF1A1A1A"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        MinWidth="{TemplateBinding ActualWidth}">
                                    <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained" />
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="DropDownBorder" Property="MinHeight" Value="40" />
                            </Trigger>
                            <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource AccentBrush}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5" />
                            </Trigger>
                            <Trigger Property="IsEditable" Value="True">
                                <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible" />
                                <Setter TargetName="ContentSite" Property="Visibility" Value="Hidden" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#FF1A1A1A" />
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
            <Setter Property="CaretBrush" Value="{StaticResource ForegroundBrush}" />
            <Setter Property="SelectionBrush" Value="{StaticResource AccentBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="8,4" />
        </Style>

        <Style x:Key="DarkListHeader" TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="#FF1A1A2E" />
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="0,0,1,1" />
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <Style x:Key="ActionButton" TargetType="Button" BasedOn="{StaticResource CmuxButton}">
            <Setter Property="Margin" Value="0,0,8,0" />
            <Setter Property="Padding" Value="12,6" />
        </Style>

        <Style x:Key="PrimaryActionButton" TargetType="Button" BasedOn="{StaticResource AccentButton}">
            <Setter Property="Margin" Value="0,0,8,0" />
            <Setter Property="Padding" Value="12,6" />
        </Style>

        <Style x:Key="DarkListItem" TargetType="ListViewItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1FFFFFFF" />
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FF252547" />
                    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border Background="{StaticResource BackgroundBrush}"
            CornerRadius="{StaticResource WindowCornerRadius}"
            BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="34" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Title bar -->
            <Border Grid.Row="0" Background="{StaticResource SidebarBackgroundBrush}"
                    CornerRadius="10,10,0,0"
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                <Grid>
                    <TextBlock Text="Command Logs" Foreground="{StaticResource ForegroundDimBrush}"
                               FontSize="12" VerticalAlignment="Center" Margin="14,0,0,0" />
                    <Button Style="{StaticResource WindowCloseButton}" HorizontalAlignment="Right"
                            WindowChrome.IsHitTestVisibleInChrome="True"
                            Click="Close_Click" Width="38" Height="34">
                        <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="9" />
                    </Button>
                </Grid>
            </Border>

            <!-- Content -->
            <Grid Grid.Row="1" Margin="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="0,0,0,8">
                    <DockPanel Margin="0,0,0,8">
                        <TextBlock Text="Date" Foreground="{StaticResource ForegroundDimBrush}"
                                   VerticalAlignment="Center" Margin="0,0,8,0" />
                        <ComboBox x:Name="DateCombo" Width="160" Style="{StaticResource SettingsCombo}" SelectionChanged="DateCombo_SelectionChanged" />
                        <Button Content="Refresh" Margin="8,0,0,0" Padding="10,4" Style="{StaticResource CmuxButton}" Click="Refresh_Click" />
                        <Button Content="Open Logs Folder" Margin="8,0,0,0" Padding="10,4" Style="{StaticResource CmuxButton}" Click="OpenFolder_Click" />
                        <Button Content="Open Terminal Captures" Margin="8,0,0,0" Padding="10,4" Style="{StaticResource CmuxButton}" Click="OpenTranscriptsFolder_Click" />
                        <Button Content="Session Vault" Margin="8,0,0,0" Padding="10,4" Style="{StaticResource CmuxButton}" Click="OpenSessionVault_Click" />
                        <TextBlock x:Name="SummaryText" Margin="16,0,0,0" VerticalAlignment="Center"
                                   Foreground="{StaticResource ForegroundDimBrush}" />
                    </DockPanel>

                    <WrapPanel>
                        <TextBlock Text="Workspace" Foreground="{StaticResource ForegroundDimBrush}" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <ComboBox x:Name="WorkspaceFilterCombo" Width="220" Style="{StaticResource SettingsCombo}"
                                  SelectionChanged="WorkspaceFilterCombo_SelectionChanged" Margin="0,0,12,0" />

                        <TextBlock Text="Surface" Foreground="{StaticResource ForegroundDimBrush}" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <ComboBox x:Name="SurfaceFilterCombo" Width="220" Style="{StaticResource SettingsCombo}"
                                  SelectionChanged="SurfaceFilterCombo_SelectionChanged" Margin="0,0,12,0" />

                        <TextBlock Text="Pane" Foreground="{StaticResource ForegroundDimBrush}" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <ComboBox x:Name="PaneFilterCombo" Width="160" Style="{StaticResource SettingsCombo}"
                                  SelectionChanged="PaneFilterCombo_SelectionChanged" Margin="0,0,12,0" />

                        <TextBlock Text="Search" Foreground="{StaticResource ForegroundDimBrush}" VerticalAlignment="Center" Margin="0,0,8,0" />
                        <TextBox x:Name="SearchBox" Width="220" Style="{StaticResource CmuxTextBox}" TextChanged="SearchBox_TextChanged" Margin="0,0,12,0" />

                        <Button Content="Clear Filters" Padding="10,4" Style="{StaticResource CmuxButton}" Click="ClearFilters_Click" />
                    </WrapPanel>
                </StackPanel>

                <ListView Grid.Row="1" x:Name="EntriesList"
                          Background="{StaticResource SurfaceBrush}" Foreground="{StaticResource ForegroundBrush}"
                          BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                          ItemContainerStyle="{StaticResource DarkListItem}"
                          MouseDoubleClick="EntriesList_MouseDoubleClick"
                          PreviewKeyDown="EntriesList_PreviewKeyDown">
                    <ListView.Resources>
                        <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource DarkListHeader}" />
                    </ListView.Resources>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Time" Width="78" DisplayMemberBinding="{Binding StartedAtLocal}" />
                            <GridViewColumn Header="Workspace" Width="210" DisplayMemberBinding="{Binding WorkspaceDisplay}" />
                            <GridViewColumn Header="Surface" Width="180" DisplayMemberBinding="{Binding SurfaceDisplay}" />
                            <GridViewColumn Header="Pane" Width="90" DisplayMemberBinding="{Binding PaneDisplay}" />
                            <GridViewColumn Header="Command" Width="300" DisplayMemberBinding="{Binding Command}" />
                            <GridViewColumn Header="Working Dir" Width="220" DisplayMemberBinding="{Binding WorkingDirectoryDisplay}" />
                            <GridViewColumn Header="Exit" Width="50" DisplayMemberBinding="{Binding ExitCodeText}" />
                            <GridViewColumn Header="Duration" Width="90" DisplayMemberBinding="{Binding DurationDisplay}" />
                        </GridView>
                    </ListView.View>
                </ListView>

                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                    <Button Content="Copy Command" Style="{StaticResource ActionButton}" Click="CopyCommand_Click" />
                    <Button Content="Insert in Focused Pane" Style="{StaticResource ActionButton}" Click="InsertCommand_Click" />
                    <Button Content="Run in Focused Pane" Style="{StaticResource PrimaryActionButton}" Click="RunCommand_Click" />
                    <Button Content="Close" Style="{StaticResource CmuxButton}" Padding="12,6" Click="Close_Click" />
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</Window>
